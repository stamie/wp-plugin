var x=jQuery("#boats-list").html();function dateToYMD(date){var d=date.getDate(),m=date.getMonth()+1,y;return date.getFullYear()+"-"+(m<=9?"0"+m:m)+"-"+(d<=9?"0"+d:d)}function format(numberInt){var number,string=numeral(numberInt).format("0,0");return string=string.replace(","," ")}function floatFormat(numberFloat){var number,string=numeral(numberFloat).format("0,0.00");return string=(string=string.replace(","," ")).replace(".",",")}function thisboatrefresh(){if(null==x){var boat_id=jQuery(".title").first().attr("attr-id"),date_from=jQuery("#check_in").val(),duration=jQuery("#duration").val(),dateFrom=new Date(date_from),dateTo=new Date(dateFrom.getFullYear(),dateFrom.getMonth(),dateFrom.getDate()+parseInt(duration));$.ajax({type:"POST",url:"/wp-content/plugins/boat-shortcodes/include/ajaxGetThisBoat.php",dataType:"json",data:{boat_id:boat_id,date_from:date_from&&""!=date_from?date_from:null,duration:duration},beforeSend:function(){jQuery(".loader").addClass("waitMeTo_Container"),jQuery(".waitContainer").css({height:"50px"}),run_waitMe(jQuery(".waitContainer"),1,"progressBar")},success:function(data){var myArray=data;if(void 0!==myArray.currency){var price1=format(parseFloat(myArray.listPrice)),price2=format(parseFloat(myArray.priceForUser)),listPrice=parseFloat(myArray.listPrice),priceForUser=parseFloat(myArray.priceForUser);$(".rentalPrice").find("td").end().html(floatFormat(myArray.priceForUser)+" "+myArray.currency),$(".rentalTotal").find("td").end().html(format(myArray.priceForUser)+" "+myArray.currency),$(".deposit").find("td").end().html(format(myArray.deposit)+" "+myArray.currency),$(".list-original-price").addClass("del"),$(".list-original-price").addClass("list-original-price-single"),price1==price2?($(".list-original-price").removeClass("del"),$(".list-original-price-single").removeClass("list-original-price"),$(".list-original-price-single").html(price1+" "+myArray.currency)):($(".list-original-price").addClass("del"),$(".list-original-price").html(price1+" "+myArray.currency),$(".list-original-price").removeClass("list-original-price-single"),$(".list-discounted-price").html(price2+" "+myArray.currency)),$("span.port").html(myArray.cityFrom);var month1=dateFrom.getMonth()+1<10?"0"+(dateFrom.getMonth()+1):""+(dateFrom.getMonth()+1),month2=dateTo.getMonth()+1<10?"0"+(dateTo.getMonth()+1):""+(dateTo.getMonth()+1),day1=dateFrom.getDate()<10?"0"+dateFrom.getDate():""+dateFrom.getDate(),day2=dateTo.getDate()<10?"0"+dateTo.getDate():""+dateTo.getDate(),htmlDateFromTo=dateFrom.getFullYear()+"-"+month1+"-"+day1+" to "+dateTo.getFullYear()+"-"+month2+"-"+day2;jQuery(".dateFromTo").html(htmlDateFromTo),myArray.discounts&&Array.isArray(myArray.discounts)&&myArray.discounts.forEach((function(value){var amount=myArray.currency;"PERCENTAGE"==value.type&&(amount="%");var discountItem=".discount_"+value.discountItemId,html="<td>"+htmlDateFromTo+"</td><td>"+value.discountItemName+"</td><td>"+value.type+"</td><td>"+value.amount+" "+amount+"</td>",table;void 0!==jQuery(discountItem).html()?jQuery(discountItem).html(html):(html='<tr class="'+(discountItem="discount_"+value.discountItemId)+'">'+html+"</tr>",jQuery(".property-table-right").first().append(html))}));var dateFrom_=htmlDateFromTo.substring(0,11),dateTo_=htmlDateFromTo.substring(14);if(void 0!==jQuery("a.button.make_option").first().attr("href")){var href=jQuery("a.button.make_option").first().attr("href");if(void 0!==href&&href.indexOf("&")>-1){var index=href.indexOf("&")+1;-1==href.indexOf("&",index)&&(index=0),href=href.substring(0,href.indexOf("&",index))}jQuery("a.button.make_option").attr("href",href+"&date_from="+dateFrom_+"&date_to="+dateTo_)}var returnHtml="",discount=0,table,trS;if(listPrice&&priceForUser&&myArray.currency&&(returnHtml+='<tr class="listPrice">',returnHtml+="<td>Charter Prices",returnHtml=(returnHtml+="</td>")+"<td>"+floatFormat(listPrice)+' <span class="cur">'+myArray.currency+"</span>",returnHtml+="</td>",returnHtml+="</tr>",discount=parseFloat(listPrice)-parseFloat(priceForUser)),myArray.discounts&&myArray.discounts.length>0&&myArray.currency){for(var returnString="",index=0;index<myArray.discounts.length;index++){var discountItem=myArray.discounts[index],amount=" "+myArray.currency+" ";"PERCENTAGE"==discountItem.type&&(amount=" % "),returnString=returnString+discountItem.amount+amount,index<myArray.discounts.length-1&&(returnString+="+ ")}returnHtml=(returnHtml=(returnHtml+='<tr class="discounts">')+"<td>Discounts ( "+returnString+")</td>")+"<td> - "+floatFormat(discount)+' <span class="cur">'+myArray.currency+"</span></td></tr>"}listPrice&&priceForUser&&myArray.currency&&(returnHtml+='<tr class="priceForUser">',returnHtml+="<td>Rental Price",returnHtml=(returnHtml+="</td>")+"<td>"+floatFormat(priceForUser)+' <span class="cur">'+myArray.currency+"</span>",returnHtml+="</td>",returnHtml+="</tr>",returnHtml+='<tr class="priceForUserTotal">',returnHtml+="<td>Rental Total",returnHtml=(returnHtml+="</td>")+"<td>"+format(priceForUser)+' <span class="cur">'+myArray.currency+"</span>",returnHtml+="</td>",returnHtml+="</tr>"),jQuery(".pricesAndDiscounts").html(returnHtml),jQuery(".property-table-right").first().find("tr").each((function(){var classes=jQuery(this).attr("class");if(classes&&classes.indexOf("discount_")>-1)for(var discountId=parseInt(classes.replace("discount_","")),index=0;index<myArray.discounts.length+1;index++){if(index==myArray.discounts.length){jQuery(this).hide();break}if(myArray.discounts[index].discountItemId==discountId){jQuery(this).show();break}}}))}else $(".list-original-price-single").html("Foglalt"),$(".list-original-price").html("Foglalt"),$(".list-original-price").removeClass("del"),$(".list-discounted-price").html("");jQuery(".loader").removeClass("waitMeTo_Container"),jQuery(".waitContainer").css({height:"0px"}),$(".waitContainer").waitMe("hide")}})}}var dateFromTo=jQuery(".dateFromTo").html();if(void 0!==dateFromTo){var dateFrom_=dateFromTo.substring(0,11),dateTo_=dateFromTo.substring(14),href=jQuery("a.button.make_option").first().attr("href");if(void 0!==href&&href.indexOf("&")>-1){var index=href.indexOf("&")+1;-1==href.indexOf("&",index)&&(index=0),href=href.substring(0,href.indexOf("&",index))}void 0!==jQuery("a.button.make_option").first().attr("href")&&jQuery("a.button.make_option").attr("href",href+"&date_from="+dateFrom_+"&date_to="+dateTo_)}void 0===jQuery("#boats-list").html()&&($("#duration").on("change",(function(){thisboatrefresh()})),$("#check_in").on("dateselected",(function(){thisboatrefresh()})));